<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="cache-control" content="no-cache">
<meta http-equiv="expires" content="0">
<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Ubuntu:bold&amp;v1">
<link rel="stylesheet" type="text/css" href="../../stylesheets/default.css">
<style>
	table {
		width: 100%;
	}
	input.translator {
		width: 40em;
	}
	td {
		width: 50%;
	}
	td input {
		width: 100%;
		margin: 5px 0;
	}
	td input.same {
		background-color: #ffe4e1;
	}
	tr.even {
		background-color: #f0f8ff;
	}
	tr.odd {
	
	}
	div.makebtn,
	div.checkbtn,
	div.checkbtn input {
		font-size: 120%;
	}
</style>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script>
	window.elFinder = function(){};
	elFinder.prototype.i18 = {};
</script>
<script src="js/i18n/elfinder.LANG.js"></script>
<script>
(function($){
	$(document).ready(function(){
		var tbl = $('#content');
		var cl = 'even';
		var elf = new elFinder();
		var as2x = '2.1';
		var src, tpl, locprms, hash, branch, lang;
		var glbs = ['translator', 'language', 'direction', 'dateFormat', 'fancyDateFormat'];

		hash = location.hash.replace(/^#/, '').match(/(2\.[01])(?::([a-zA-Z0-9-]{2,5}))/);
		branch = (hash && hash[1])? hash[1] : '2.1';
		lang = (hash && hash[2])? hash[2] : '';

		$.getScript('./'+branch+'/i18n/elfinder.LANG.js', function() {
			src = elf.i18.REPLACE_WITH_xx_OR_xx_YY_LANG_CODE.messages;
			
			$.get('./'+branch+'/i18n/elfinder.LANG.js', {}, function(data){
				tpl = data;
			});
			$('#lngbtn').on('click', function(){
				var lng = $('#lng').val();
				var slng = elf.i18.REPLACE_WITH_xx_OR_xx_YY_LANG_CODE;
				var make;
				var filename = './'+branch+'/i18n/elfinder.'+lng+'.js';
				var tgt = (branch == as2x)? '2.x' : branch;
				$.getScript(filename)
				.done(function(){
					make = $.extend(true, {}, slng, elf.i18[lng]);
					$('#editgh').attr('href', 'https://github.com/Studio-42/elFinder/edit/'+tgt+'/js/i18n/elfinder.'+lng+'.js');
				})
				.fail(function(){
					make = $.extend(true, {}, slng);
					$('#editgh').attr('href', 'https://github.com/Studio-42/elFinder/new/'+tgt+'/js/i18n');
				})
				.always(function(){
					$('.langname').text(lng);
					$.each(glbs, function(k, v){
						$('#glbs-'+v).val(make[v].replace(/&lt;/g, '<').replace(/&gt;/g, '>'));
					});
					$.each(src, function(k, v){
						$('#inp-'+k).val(make.messages[k])[(make.messages[k] == slng.messages[k])?'addClass':'removeClass']('same');
					});
				});
			});
			$('#lng').on('keydown', function(e){
				if (e.keyCode == 13) {
					$('#lngbtn').trigger('click');
					$('#made').val('');
					location.hash = '#'+branch+':'+$('#lng').val();
				}
			});
			$('#make').on('click', function(){
				var date = new Date();
				var year = date.getFullYear();
				var month = date.getMonth() + 1;
				var day = date.getDate();
				  
				if ( month < 10 ) {
					month = '0' + month;
				}  
				if ( day < 10 ) {
					day = '0' + day;
				}  

				var lng = $('#lng').val();
				var made = tpl;
				var language = $('#glbs-language').val();
				var head = '/**\n * '+language+' translation\n';
				var authors = $('#glbs-translator').val().split(',');
				$.each(authors, function(k, v){
					head += ' * @author '+v.trim()+'\n';
				});
				head += ' * @version '+year+'-'+month+'-'+day+'\n';
				head += ' */\n';
				made = head + made.replace(/^[\s\S]+(if \(elFinder)/, '$1')
				.replace(/(elFinder\.prototype\.i18\.)REPLACE_WITH_xx_OR_xx_YY_LANG_CODE( = {)/, '$1'+lng+'$2')
				.replace(/(\/\*\*\s+\* )XXXXX( translation)/, '$1'+language+'$2');
				$.each(glbs, function(k, v){
					var reg = new RegExp('(\\b'+v+'\\b\\s*:\\s*\').+(\')');
					made = made.replace(reg, function(str, p1, p2){return p1+$('#glbs-'+v).val().replace(/'/g, "\\'").replace(/</g, '&lt;').replace(/>/g, '&gt;')+p2;});
				});
				$.each(src, function(k, v){
					var reg = new RegExp('(\''+k+'\'\\s*:\\s*\').+(\')');
					made = made.replace(reg, function(str, p1, p2){return p1+$('#inp-'+k).val().replace(/'/g, "\\'")+p2;});
				});
				$('#made').val(made.replace(/[ \t]+([\r\n])/g, '$1'));
			});
			$('#content').on('change', 'input', function(){
				var k = this.id.substr(4);
				$(this)[($(this).val() == src[k])?'addClass':'removeClass']('same');
			});

			$.each(glbs, function(k, v){
				$('#glbs').append($('<div>')).append(v+': <input id="glbs-'+v+'" class="'+v+'" type="text">');
			});
			$.each(src, function(k, v){
				cl = (cl == 'even')? 'odd' : 'even';
				tbl.append($('<tr class="'+cl+'"><td id="en-'+k+'" title="'+k+'">'+v+'</td><td id="lng-'+k+'"><input id="inp-'+k+'" class="mesinp" type="text" title="'+k+'"></input></td></tr>'));
			});
			$('span.branch').text(branch);
			
			if (lang) {
				$('#lng').val(lang);
				$('#lngbtn').trigger('click');
			}
			$('#made').val('');
			
		});
	});
})(jQuery);
</script>
</head>
<body>
	<div class="header clearfix">
		<div class="logo">
		<a href="../../" target="_blank"><img src="../../images/elfinder-logo.png" alt="elFinder logo" /></a>
		<h1><a href="../../" target="_blank">elFinder <span>file manager for web</span></a></h1>
		</div>
		<div class="menu">
			<ul>
				<li>i18n Translation Tool</li>
			</ul>
		</div>
	</div>
	<div class="checkbtn">
		Language code: <input id="lng" name="lng" size="4"><button id="lngbtn">Check it!</button>
	</div>
	<hr>
	<h2>header</h2>
	<div id="glbs"></div>
	<hr>
	<h2>messages</h2>
	<table id="content"></table>
	<hr>
	<div class="makebtn">
		js/i18n/elfinder.<span class="langname">LANG</span>.js -	<button id="make">Make It!</button> and <a id="editgh" target="_blank">Edit on GitHub!</a>
	</div>
	<hr>
	<textarea id="made" style="width:100%;height:20em"></textarea>
</body>
</html>