!function(e,t){if("function"==typeof define&&define.amd)define(["elfinder"],e);else if(t){var o=t.prototype._options.commandsOptions.edit.editors;t.prototype._options.commandsOptions.edit.editors=o.concat(e(t))}}(function(e){"use strict";var t=window.location.search.match(/getfile=([a-z]+)/),o=e.prototype.hasRequire,i=function(){var e;try{e=!!new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(t){e=!!("undefined"==typeof window.orientation||navigator&&navigator.mimeTypes["application/x-shockwave-flash"])}return e}(),n=function(e,t,o,i){var n=$(this).children("img:first"),a=$("<div/>").css({position:"absolute",top:"50%",textAlign:"center",width:"100%",fontSize:"16pt"}).html(i.i18n("ntfloadimg")).hide().appendTo(this);n.attr("id",e+"-img").attr("src",o).css({height:"","max-width":"100%","max-height":"100%",cursor:"pointer"}).data("loading",function(e){var t=n.closest(".elfinder-dialog").find("button,.elfinder-titlebar-button");return t.prop("disabled",!e)[e?"removeClass":"addClass"]("ui-state-disabled"),n.css("opacity",e?"":"0.3"),a[e?"hide":"show"](),n})},a=function(e,t){var o,i,n,a=e.attr("style");try{e.attr("style",""),o=e.get(0),i=document.createElement("canvas"),i.width=o.width,i.height=o.height,e.attr("style",a),i.getContext("2d").drawImage(o,0,0),n=i.toDataURL(t)}catch(r){n=e.attr("src")}return n},r=function(){if(i&&window.parent!==window){var e,t,o,n,a=window.location.search.match(/[?&]pixlr=([^&]+)/),r=window.location.search.match(/[?&]image=([^&]+)/);a&&(e=window.parent,t=e.$("#"+a[1]+"iframe").hide(),n=e.$("#"+a[1]).data("resizeoff")(),"http"===r[1].substr(0,4)?(o=r[1],"https:"===window.location.protocol&&(o=o.replace(/^http:/,"https:")),n.on("load error",function(){n.data("loading")(!0)}).attr("src",o).data("loading")()):n.data("loading")(!0),t.remove())}},c=function(e,t){i&&!t.UA.ltIE8||(this.disabled=!0)},d=function(e,t){var o,i=this,n=this.fm,a=$(t).children("img:first").data("loading")().data("resizeoff",function(){return $(window).off("resize."+a.attr("id")),r.addClass(n.resources["class"].preventback),a}).on("click",function(){f()}),r=$(t).closest(".ui-dialog"),c=n.getUI(),d=$('<iframe class="ui-front" allowtransparency="true">'),s=this.file,l=function(e){d.remove(),a.data("loading")(!0),n.error(e||"Can not launch Pixlr.")},f=function(){var f="https://pixlr.com/"+e+"/?s=c",p=window.location.href.toString().replace(/#.*$/,""),m={};o=setTimeout(l,15e3),p+=(p.indexOf("?")===-1?"?":"&")+"pixlr="+a.attr("id"),f+="&referrer=elFinder&locktitle=true",f+="&exit="+encodeURIComponent(p+"&image=0"),f+="&target="+encodeURIComponent(p),f+="&title="+encodeURIComponent(s.name),f+="&locktype="+encodeURIComponent("image/png"===s.mime?"png":"jpg"),f+="&image="+encodeURIComponent(a.attr("src")),m.src=f,m.css={width:"100%",height:$(window).height()+"px",position:"fixed",display:"block",backgroundColor:"transparent",border:"none",top:0,right:0},i.trigger("Prepare",{node:t,editorObj:void 0,instance:d,opts:m}),d.attr("id",a.attr("id")+"iframe").attr("src",m.src).css(m.css).on("load",function(){o&&clearTimeout(o),setTimeout(function(){d.is(":hidden")&&l("Please disable your ad blocker.")},1e3),r.addClass(n.resources["class"].preventback),n.toFront(d)}).on("error",l).appendTo(c.hasClass("elfinder-fullscreen")?c:"body"),$(window).on("resize."+a.attr("id"),function(){d.css("height",$(window).height())})};f()};return r(),t&&(t=t[1],"ckeditor"===t?e.prototype._options.getFileCallback=function(e,t){window.opener.CKEDITOR.tools.callFunction(function(){var e=new RegExp("(?:[?&]|&amp;)CKEditorFuncNum=([^&]+)","i"),t=window.location.search.match(e);return t&&t.length>1?t[1]:""}(),t.convAbsUrl(e.url)),t.destroy(),window.close()}:"tinymce"===t&&(e.prototype._options.getFileCallback=function(e,t){parent.tinymce.activeEditor.windowManager.getParams().oninsert(e,t),parent.tinymce.activeEditor.windowManager.close()})),[{info:{id:"pixlreditor",name:"Pixlr Editor",iconImg:"img/edit_pixlreditor.png",urlAsContent:!0,schemeContent:!0,single:!0},mimes:["image/jpeg","image/png"],html:'<div style="width:100%;height:300px;max-height:100%;text-align:center;"><img/></div>',setup:function(e,t){c.call(this,e,t)},init:function(e,t,o,i){n.call(this,e,t,i.convAbsUrl(o),i)},getContent:function(){return $(this).children("img:first").attr("src")},load:function(e){d.call(this,"editor",e)},save:function(e){},close:function(e){}},{info:{id:"pixlrexpress",name:"Pixlr Express",iconImg:"img/edit_pixlrexpress.png",urlAsContent:!0,schemeContent:!0,single:!0},mimes:["image/jpeg"],html:'<div style="width:100%;height:300px;max-height:100%;text-align:center;"><img/></div>',setup:function(e,t){c.call(this,e,t)},init:function(e,t,o,i){n.call(this,e,t,i.convAbsUrl(o),i)},getContent:function(){return $(this).children("img:first").attr("src")},load:function(e){d.call(this,"express",e)},save:function(e){},close:function(e){}},{info:{id:"creativecloud",name:"Creative Cloud",iconImg:"img/edit_creativecloud.png",schemeContent:!0,single:!0},mimes:["image/jpeg","image/png"],html:'<div style="width:100%;height:300px;max-height:100%;text-align:center;"><img/></div>',setup:function(e,t){!t.UA.ltIE8&&e.extraOptions&&e.extraOptions.creativeCloudApiKey?this.apiKey=e.extraOptions.creativeCloudApiKey:this.disabled=!0},init:function(e,t,o,i){n.call(this,e,t,o,i)},getContent:function(){return $(this).children("img:first").attr("src")},load:function(e){var t,o=this,i=this.fm,n=$(e).children("img:first"),a=$(e).closest(".ui-dialog"),r=i.getUI(),c=$.Deferred(),d=$("#elfinder-aviary-container"),s=function(s){var f,p=function(){var e={zh_TW:"zh_HANT",zh_CN:"zh_HANS"};return e[i.lang]?e[i.lang]:i.lang};d.length?d.appendTo(d.parent()):(d=$('<div id="elfinder-aviary-container" class="ui-front"/>').css({position:"fixed",top:0,right:0,width:"100%",height:$(window).height(),overflow:"auto"}).hide().appendTo(r.hasClass("elfinder-fullscreen")?r:"body"),$(window).on("resize."+i.namespace,function(){d.css("height",$(window).height())}),r.on("resize."+i.namespace,function(e,t){e.preventDefault(),e.stopPropagation(),t&&t.fullscreen&&d.appendTo("on"===t.fullscreen?r:"body")}),i.bind("destroy",function(){d.remove()})),n.on("click",l).data("loading")(),f={apiKey:o.confObj.apiKey,onSave:function(e,o){t.showWaitIndicator(),n.on("load error",function(){n.data("loading")(!0)}).attr("crossorigin","anonymous").attr("src",o).data("loading")(),t.close()},onLoad:s||function(){},onClose:function(){a.removeClass(i.resources["class"].preventback),$(d).hide()},appendTo:d.get(0),maxSize:2048,language:p()},o.trigger("Prepare",{node:e,editorObj:Aviary,instance:void 0,opts:f}),t=new Aviary.Feather(f),d.css("z-index",$(e).closest(".elfinder-dialog").css("z-index")),c.resolve(t)},l=function(){a.addClass(i.resources["class"].preventback),$(d).show(),t.launch({image:n.attr("id"),url:n.attr("src")}),n.data("loading")(!0)};return"undefined"==typeof Aviary?i.loadScript(["https://dme0ih8comzn4.cloudfront.net/imaging/v3/editor.js"],function(){s(l)},{loadType:"tag"}):(s(),l()),c},save:function(e){var t=$(e).children("img:first");"data:"!==t.attr("src").substr(0,5)&&t.attr("src",a(t,this.file.mime))}},{setup:function(e,t){!t.UA.ltIE8&&t.options.cdns.ace||(this.disabled=!0)},info:{id:"aceeditor",name:"ACE Editor",iconImg:"img/edit_aceeditor.png"},load:function(e){var t=this,o=this.fm,i=$.Deferred(),n=o.options.cdns.ace,a=function(){var o,a,r,c=$(e),d=c.parent(),s=(d.parent(),e.id+"_ace"),l=(t.file.name.replace(/^.+\.([^.]+)|(.+)$/,"$1$2").toLowerCase(),{"text/x-php":"php","application/x-php":"php","text/html":"html","application/xhtml+xml":"html","text/javascript":"javascript","application/javascript":"javascript","text/css":"css","text/x-c":"c_cpp","text/x-csrc":"c_cpp","text/x-chdr":"c_cpp","text/x-c++":"c_cpp","text/x-c++src":"c_cpp","text/x-c++hdr":"c_cpp","text/x-shellscript":"sh","application/x-csh":"sh","text/x-python":"python","text/x-java":"java","text/x-java-source":"java","text/x-ruby":"ruby","text/x-perl":"perl","application/x-perl":"perl","text/x-sql":"sql","text/xml":"xml","application/docbook+xml":"xml","application/xml":"xml"});d.height(d.height()),ace.config.set("basePath",n),a=$('<div id="'+s+'" style="width:100%; height:100%;"/>').text(c.val()).insertBefore(c.hide()),c.data("ace",!0),o=ace.edit(s),o.$blockScrolling=1/0,o.setOptions({theme:"ace/theme/monokai",fontSize:"14px",wrap:!0}),ace.config.loadModule("ace/ext/modelist",function(){r=ace.require("ace/ext/modelist").getModeForPath("/"+t.file.name).name,"text"===r&&l[t.file.mime]&&(r=l[t.file.mime]),d.prev().children(".elfinder-dialog-title").append(" ("+t.file.mime+" : "+r.split(/[\/\\]/).pop()+")"),o.setOptions({mode:"ace/mode/"+r})}),ace.config.loadModule("ace/ext/language_tools",function(){ace.require("ace/ext/language_tools"),o.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!1})}),ace.config.loadModule("ace/ext/settings_menu",function(){ace.require("ace/ext/settings_menu").init(o)}),o.commands.addCommand({name:"saveFile",bindKey:{win:"Ctrl-s",mac:"Command-s"},exec:function(e){t.doSave()}}),o.commands.addCommand({name:"closeEditor",bindKey:{win:"Ctrl-w|Ctrl-q",mac:"Command-w|Command-q"},exec:function(e){t.doCancel()}}),o.resize(),$('<div class="ui-dialog-buttonset"/>').css("float","left").append($("<button/>").html(t.fm.i18n("TextArea")).button().on("click",function(){c.data("ace")?(c.removeData("ace"),a.hide(),c.val(o.session.getValue()).show().trigger("focus"),$(this).text("AceEditor")):(c.data("ace",!0),a.show(),o.setValue(c.hide().val(),-1),o.focus(),$(this).html(t.fm.i18n("TextArea")))})).append($("<button>Ace editor setting</button>").button({icons:{primary:"ui-icon-gear",secondary:"ui-icon-triangle-1-e"},text:!1}).on("click",function(){o.showSettingsMenu(),$("#ace_settingsmenu").css("font-size","80%").find('div[contains="setOptions"]').hide().end().parent().parent().appendTo($("#elfinder"))})).prependTo(d.next()),t.trigger("Prepare",{node:e,editorObj:ace,instance:o,opts:{}}),i.resolve(o)};return t.confObj.loader||(t.confObj.loader=$.Deferred(),t.fm.loadScript([n+"/ace.js"],function(){t.confObj.loader.resolve()},void 0,{obj:window,name:"ace"})),t.confObj.loader.done(a),i},close:function(e,t){t&&t.destroy()},save:function(e,t){t&&$(e).data("ace")&&(e.value=t.session.getValue())},focus:function(e,t){t&&$(e).data("ace")&&t.focus()},resize:function(e,t,o,i){t&&t.resize()}},{setup:function(e,t){!t.UA.ltIE10&&t.options.cdns.codemirror||(this.disabled=!0)},info:{id:"codemirror",name:"CodeMirror",iconImg:"img/edit_codemirror.png"},load:function(e){var t=this.fm,i=t.options.cdns.codemirror,n=$.Deferred(),a=this,r=function(t){var r,c,d,s=$(e),l=s.parent();l.height(l.height()),d={lineNumbers:!0,lineWrapping:!0,extraKeys:{"Ctrl-S":function(){a.doSave()},"Ctrl-Q":function(){a.doCancel()},"Ctrl-W":function(){a.doCancel()}}},a.trigger("Prepare",{node:e,editorObj:t,instance:void 0,opts:d}),r=t.fromTextArea(e,d),n.resolve(r);var f,p,m,u;f||(f=t.findModeByMIME(a.file.mime)),!f&&(p=a.file.name.match(/.+\.([^.]+)$/))&&(f=t.findModeByExtension(p[1])),f&&(t.modeURL=o?"codemirror/mode/%N/%N.min":i+"/mode/%N/%N.min.js",m=f.mode,u=f.mime,r.setOption("mode",u),t.autoLoadMode(r,m),l.prev().children(".elfinder-dialog-title").append(" ("+u+" : "+m+")")),c=$(r.getWrapperElement()).css({padding:0,border:"none"}),s.data("cm",!0),c.height("100%"),$('<div class="ui-dialog-buttonset"/>').css("float","left").append($("<button/>").html(a.fm.i18n("TextArea")).button().on("click",function(){s.data("cm")?(s.removeData("cm"),c.hide(),s.val(r.getValue()).show().trigger("focus"),$(this).text("CodeMirror")):(s.data("cm",!0),c.show(),r.setValue(s.hide().val()),r.refresh(),r.focus(),$(this).html(a.fm.i18n("TextArea")))})).prependTo(l.next())};return a.confObj.loader||(a.confObj.loader=$.Deferred(),o?(require.config({packages:[{name:"codemirror",location:i,main:"codemirror.min"}],map:{codemirror:{"codemirror/lib/codemirror":"codemirror"}}}),require(["codemirror","codemirror/addon/mode/loadmode.min","codemirror/mode/meta.min"],function(e){a.confObj.loader.resolve(e)})):a.fm.loadScript([i+"/codemirror.min.js"],function(){a.fm.loadScript([i+"/addon/mode/loadmode.min.js",i+"/mode/meta.min.js"],function(){a.confObj.loader.resolve(CodeMirror)})},{loadType:"tag"}),a.fm.loadCss(i+"/codemirror.css")),a.confObj.loader.done(r),n},close:function(e,t){t&&t.toTextArea()},save:function(e,t){t&&$(e).data("cm")&&(e.value=t.getValue())},focus:function(e,t){t&&$(e).data("cm")&&t.focus()},resize:function(e,t,o,i){t&&t.refresh()}},{setup:function(e,t){!t.UA.ltIE10&&t.options.cdns.simplemde||(this.disabled=!0)},info:{id:"simplemde",name:"SimpleMDE",iconImg:"img/edit_simplemde.png"},exts:["md"],load:function(e){var t=this,i=this.fm,n=$(e).parent(),a=$.Deferred(),r=i.options.cdns.simplemde,c=function(o){var i,r,c,d=n.height(),s=n.outerHeight(!0)-d+14;e._setHeight=function(e){var t,o=e||n.height(),a=0;return n.children(".editor-toolbar,.editor-statusbar").each(function(){a+=$(this).outerHeight(!0)}),t=o-a-s,r.height(t),i.codemirror.refresh(),t},n.height(d),c={element:e,autofocus:!0},t.trigger("Prepare",{node:e,editorObj:o,instance:void 0,opts:c}),i=new o(c),a.resolve(i),r=$(i.codemirror.getWrapperElement()),r.css("min-height","50px").children(".CodeMirror-scroll").css("min-height","50px"),e._setHeight(d)};return t.confObj.loader||(t.confObj.loader=$.Deferred(),t.fm.loadCss(r+"/simplemde.min.css"),o?require([r+"/simplemde.min.js"],function(e){t.confObj.loader.resolve(e)}):t.fm.loadScript([r+"/simplemde.min.js"],function(){t.confObj.loader.resolve(SimpleMDE)},{loadType:"tag"})),t.confObj.loader.done(c),a},close:function(e,t){t&&t.toTextArea(),t=null},save:function(e,t){t&&(e.value=t.value())},focus:function(e,t){t&&t.codemirror.focus()},resize:function(e,t,o,i){t&&e._setHeight()}},{info:{id:"ckeditor",name:"CKEditor",iconImg:"img/edit_ckeditor.png"},exts:["htm","html","xhtml"],setup:function(e,t){t.options.cdns.ckeditor?e.extraOptions&&e.extraOptions.managerUrl&&(this.managerUrl=e.extraOptions.managerUrl):this.disabled=!0},load:function(e){var t=this,o=this.fm,i=$.Deferred(),n=function(){var n,a=$(e).parent(),r=a.closest(".elfinder-dialog"),c=a.height(),d=/([&?]getfile=)[^&]+/,s=t.confObj.managerUrl||window.location.href.replace(/#.*$/,""),l="ckeditor";d.test(s)?s=s.replace(d,"$1"+l):s+="?getfile="+l,a.height(c),n={startupFocus:!0,fullPage:!0,allowedContent:!0,filebrowserBrowseUrl:s,toolbarCanCollapse:!0,toolbarStartupExpanded:!o.UA.Mobile,removePlugins:"resize",extraPlugins:"colorbutton,justify,docprops",on:{instanceReady:function(n){var a=n.editor;a.resize("100%",c),r.one("beforedommove."+o.namespace,function(){a.destroy()}).one("dommove."+o.namespace,function(){t.load(e).done(function(e){t.instance=e})}),i.resolve(n.editor)}}},t.trigger("Prepare",{node:e,editorObj:CKEDITOR,instance:void 0,opts:n}),CKEDITOR.replace(e.id,n),CKEDITOR.on("dialogDefinition",function(e){var t=e.data.definition.dialog;t.on("show",function(e){o.getUI().append($(".cke_dialog_background_cover")).append(this.getElement().$)}),t.on("hide",function(e){$("body:first").append($(".cke_dialog_background_cover")).append(this.getElement().$)})})};return t.confObj.loader||(t.confObj.loader=$.Deferred(),window.CKEDITOR_BASEPATH=o.options.cdns.ckeditor+"/",$.getScript(o.options.cdns.ckeditor+"/ckeditor.js",function(){t.confObj.loader.resolve()})),t.confObj.loader.done(n),i},close:function(e,t){t&&t.destroy()},save:function(e,t){t&&(e.value=t.getData())},focus:function(e,t){t&&t.focus()},resize:function(e,t,o,i){t&&"ready"===t.status&&t.resize("100%",$(e).parent().height())}},{info:{id:"ckeditor5",name:"CKEditor5",iconImg:"img/edit_ckeditor5.png"},exts:["htm","html","xhtml"],html:'<div class="edit-editor-ckeditor5"></div>',setup:function(e,t){var o=this;t.options.cdns.ckeditor5&&"function"==typeof window.Symbol&&"symbol"==typeof Symbol()?e.extraOptions&&e.extraOptions.ckeditor5Mode&&(this.ckeditor5Mode=e.extraOptions.ckeditor5Mode):this.disabled=!0,t.bind("destroy",function(){o.editor=null})},prepare:function(e,t,o){$(e).height(e.editor.fm.getUI().height()-100)},init:function(e,t,o,i){var n=o.match(/^([\s\S]*<body[^>]*>)([\s\S]+)(<\/body>[\s\S]*)$/i),a="",r="",c="";this.css({width:"100%",height:"100%","box-sizing":"border-box"}),n?(a=n[1],r=n[2],c=n[3]):r=o,this.data("data",{header:a,body:r,footer:c})},load:function(e){var t,o=this,i=this.fm,n=$.Deferred(),a=o.confObj.ckeditor5Mode||"balloon",r=function(){var e=i.lang.toLowerCase().replace("_","-");return"zh"===e.substr(0,2)&&"zh-cn"!==e&&(e="zh"),e}(),c=function(t){var a,c=$(e).parent();c.height(i.getUI().height()-100),a={toolbar:["heading","|","bold","italic","link","imageUpload","bulletedList","numberedList","blockQuote","undo","redo"],language:r},o.trigger("Prepare",{node:e,editorObj:t,instance:void 0,opts:a}),t.create(e,a).then(function(t){var o=t.plugins.get("FileRepository");o.createUploadAdapter=function(e){return new d(e)},t.setData($(e).data("data").body),i.getUI().append($("body > div.ck-body")),$("div.ck-balloon-panel").css({"z-index":i.getMaximizeCss().zIndex+1}),n.resolve(t)})["catch"](function(e){i.error(e)})},d=function(e){this.upload=function(){return new Promise(function(t,o){i.exec("upload",{files:[e.file]},void 0,i.cwd().hash).done(function(e){e.added&&e.added.length?i.url(e.added[0].hash,{async:!0}).done(function(e){t({"default":i.convAbsUrl(e)})}).fail(function(){o("errFileNotFound")}):o(i.i18n(e.error?e.error:"errUpload"))}).fail(function(e){o(i.i18n(e?"userabort"===e?"errAbort":e:"errUploadNoFiles"))}).progress(function(t){e.uploadTotal=t.total,e.uploaded=t.progress})})},this.abort=function(){i.getUI().trigger("uploadabort")}};return o.confObj.editor?c(o.confObj.editor):(t=$.Deferred(),o.fm.loadScript([i.options.cdns.ckeditor5+"/"+a+"/ckeditor.js"],function(e){e||(e=window.BalloonEditor||window.InlineEditor||window.ClassicEditor),"en"!==i.lang?o.fm.loadScript([i.options.cdns.ckeditor5+"/"+a+"/translations/"+r+".js"],function(o){t.resolve(e)},{tryRequire:!0,loadType:"tag",error:function(o){r="en",t.resolve(e)}}):t.resolve(e)},{tryRequire:!0,loadType:"tag"}),t.done(function(e){o.confObj.editor=e,c(e)})),n},getContent:function(){var e=$(this).data("data");return e.header+e.body+e.footer},close:function(e,t){t&&t.destroy()},save:function(e,t){var o=$(e),i=o.data("data");t&&(i.body=t.getData(),o.data("data",i))},focus:function(e,t){$(e).trigger("focus")}},{info:{id:"tinymce",name:"TinyMCE",iconImg:"img/edit_tinymce.png"},exts:["htm","html","xhtml"],setup:function(e,t){t.options.cdns.tinymce?e.extraOptions&&e.extraOptions.managerUrl&&(this.managerUrl=e.extraOptions.managerUrl):this.disabled=!0},load:function(e){var t=this,o=this.fm,i=$.Deferred(),n=function(){var n,a=$(e).parent(),r=a.closest(".elfinder-dialog"),c=a.height(),d=a.outerHeight(!0)-c;a.height(c),e._setHeight=function(e){var t,o=$(this).parent(),i=e||o.height(),n=0;return o.find(".mce-container-body:first").children(".mce-toolbar,.mce-toolbar-grp,.mce-statusbar").each(function(){n+=$(this).outerHeight(!0)}),t=i-n-d,o.find(".mce-edit-area iframe:first").height(t),t},n={selector:"#"+e.id,resize:!1,plugins:["fullpage","image","link","media","code","fullscreen"],init_instance_callback:function(n){e._setHeight(c),r.one("beforedommove."+o.namespace,function(){tinymce.execCommand("mceRemoveEditor",!1,e.id)}).one("dommove."+o.namespace,function(){t.load(e).done(function(e){t.instance=e})}),i.resolve(n)},file_picker_callback:function(e,o,i){var n=/([&?]getfile=)[^&]+/,a=t.confObj.managerUrl||window.location.href.replace(/#.*$/,""),r="tinymce";return n.test(a)?a=a.replace(n,"$1"+r):a+="?getfile="+r,tinymce.activeEditor.windowManager.open({file:a,title:"elFinder",width:900,height:450,resizable:"yes"},{oninsert:function(t,o){var n,a;n=o.convAbsUrl(t.url),a=t.name+" ("+o.formatSize(t.size)+")","file"==i.filetype&&e(n,{text:a,title:a}),"image"==i.filetype&&e(n,{alt:a}),"media"==i.filetype&&e(n)}}),!1}},t.trigger("Prepare",{node:e,editorObj:tinymce,instance:void 0,opts:n}),tinymce.init(n)};return o.getUI().hasClass("elfinder-fullscreen-native")&&o.exec("fullscreen"),t.confObj.loader||(t.confObj.loader=$.Deferred(),$.getScript(o.options.cdns.tinymce+"/tinymce.min.js",function(){setTimeout(function(){t.confObj.loader.resolve()},0)})),t.confObj.loader.done(n),i},close:function(e,t){t&&tinymce.execCommand("mceRemoveEditor",!1,e.id)},save:function(e,t){t&&t.save()},focus:function(e,t){t&&t.focus()},resize:function(e,t,o,i){t&&e._setHeight()}},{info:{id:"zohoeditor",name:"Zoho Editor",iconImg:"img/edit_zohooffice.png",cmdCheck:"ZohoOffice",preventGet:!0,hideButtons:!0},mimes:["application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.oasis.opendocument.text","application/rtf","text/html","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.oasis.opendocument.spreadsheet","application/vnd.sun.xml.calc","text/csv","text/tab-separated-values","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.presentationml.slideshow","application/vnd.oasis.opendocument.presentation","application/vnd.sun.xml.impress"],html:'<iframe style="width:100%;max-height:100%;border:none;"></iframe>',setup:function(e,t){(t.UA.Mobile||t.UA.ltIE8)&&(this.disabled=!0)},prepare:function(e,t,o){var i=e.editor.fm.getUI();$(e).height(i.height()),t.width=Math.max(t.width||0,.8*i.width())},init:function(e,t,o,i){var n=this,a=$(this).hide(),r=$("<div/>").css({position:"absolute",top:"50%",textAlign:"center",width:"100%",fontSize:"16pt"}).html(i.i18n("nowLoading")+'<span class="elfinder-spinner"/>').appendTo(a.parent()),c=function(){var e="";return $.each(i.customData,function(t,o){e+="&"+encodeURIComponent(t)+"="+encodeURIComponent(o)}),e};$(n).data("xhr",i.request({data:{cmd:"editor",name:"ZohoOffice",method:"init","args[target]":t.hash,"args[lang]":i.lang,"args[cdata]":c},preventDefault:!0}).done(function(e){var t;e.zohourl?(t={css:{height:"100%"}},n.editor.trigger("Prepare",{node:n,editorObj:void 0,instance:a,opts:t}),a.attr("src",e.zohourl).show().css(t.css)):(e.error&&i.error(e.error),n.elfinderdialog("destroy"))}).fail(function(e){e&&i.error(e),n.elfinderdialog("destroy")}).always(function(){r.remove()}))},load:function(){},getContent:function(){},save:function(){},beforeclose:function(e){var t=$.Deferred(),o="about:blank";return e.src=o,setTimeout(function(){var i;try{i=e.contentWindow.location.href}catch(n){i=null}i===o?t.resolve():t.reject()},10),t},close:function(e){var t=this.fm,o=$(e).data("xhr");"pending"===o.state()?o.reject():t.sync(t.cwd().hash)}},{info:{id:"ziparchive",name:"btnMount",cmdCheck:"ZipArchive",edit:function(e,t){var o=this,i=$.Deferred();return o.request({data:{cmd:"netmount",protocol:"ziparchive",host:e.hash,path:e.phash},notify:{type:"netmount",cnt:1,hideCnt:!0}}).done(function(e){var t;e.added&&e.added.length&&(e.added[0].phash&&(t=o.file(e.added[0].phash))&&(t.dirs||(t.dirs=1,o.change({changed:[t]}))),o.one("netmountdone",function(){o.exec("open",e.added[0].hash),o.one("opendone",function(){e.toast&&o.toast(e.toast)})})),i.resolve()}).fail(function(e){i.reject(e)}),i}},mimes:["application/zip"],load:function(){},save:function(){}},{info:{id:"textarea",name:"TextArea",useTextAreaEvent:!0},load:function(e){this.trigger("Prepare",{node:e,editorObj:void 0,instance:void 0,opts:{}})},save:function(){}}]},window.elFinder);